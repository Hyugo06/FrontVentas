<div class="container mx-auto p-8 max-w-4xl">

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Mi Carrito de Compras</h1>
    <a routerLink="/productos" class="text-blue-500 hover:underline">
      &larr; Volver a la Tienda
    </a>
  </div>

  @if (items$ | async; as items) {
    @if (items.length > 0) {

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

        <div class="md:col-span-2 space-y-4">

          @for (item of items; track item.producto.idProducto) {
            <div class="flex items-center bg-white p-4 rounded-lg shadow-md">
              <div class="w-20 h-20 bg-gray-200 rounded-md mr-4 flex-shrink-0"></div>

              <div class="flex-grow">
                <span class="text-xs text-gray-500">{{ item.producto.marca?.nombre }}</span>
                <h3 class="font-semibold text-lg">{{ item.producto.nombre }}</h3>
                <p class="text-blue-600 font-bold">S/ {{ item.producto.precioVenta | number: '1.2-2' }}</p>
              </div>

              <div class="flex items-center border rounded-lg mx-4">
                <button (click)="decrementar(item)" class="px-3 py-1 text-lg font-bold text-gray-600 hover:bg-gray-100 rounded-l-lg">
                  -
                </button>
                <span class="px-4 py-1 text-center w-12">{{ item.cantidad }}</span>
                <button (click)="incrementar(item)" class="px-3 py-1 text-lg font-bold text-gray-600 hover:bg-gray-100 rounded-r-lg">
                  +
                </button>
              </div>

              <button (click)="eliminar(item)" class="text-red-500 hover:text-red-700 font-medium">
                Eliminar
              </button>
            </div>
          }
        </div>

        <div class="md:col-span-1">
          <div class="bg-white p-6 rounded-lg shadow-xl sticky top-24">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2">Resumen del Pedido</h2>
            <div class="flex justify-between mb-4">
              <span class="text-gray-600">Subtotal:</span>
              <span class="font-semibold">S/ {{ total$ | async | number: '1.2-2' }}</span>
            </div>
            <div class="flex justify-between mb-6">
              <span class="text-gray-600">Envío:</span>
              <span class="font-semibold">Gratis</span>
            </div>
            <div class="flex justify-between font-bold text-2xl border-t pt-4">
              <span>TOTAL:</span>
              <span>S/ {{ total$ | async | number: '1.2-2' }}</span>
            </div>

            <a routerLink="/checkout"
               class="block w-full text-center mt-6 bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-colors">
              Continuar Compra
            </a>
          </div>
        </div>
      </div>

    } @else {
      <div class="text-center p-12 bg-white rounded-lg shadow-md">
        <h2 class="text-2xl font-semibold mb-4">Tu carrito está vacío</h2>
        <p class="text-gray-600 mb-6">Aún no has añadido productos. ¡Explora la tienda!</p>
        <a routerLink="/productos" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">
          Ir a la Tienda
        </a>
      </div>
    }
  }

</div>
